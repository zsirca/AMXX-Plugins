/* Plugin generated by AMXX-Studio */

#include <amxmodx>
#include <amxmisc>
#include <hamsandwich>

#define PLUGIN "BUSCADOR DE ADMIN Y RCON ACTIVAS"
#define VERSION "1.0"
#define AUTHOR "zsirca"

/*   ADMIN = ADMIN_BAN | VIP = ADMIN_KICK   */


public plugin_init() {
    register_plugin(PLUGIN, VERSION, AUTHOR)
    
    register_clcmd( "say /admin" , "msn_admin")
    register_clcmd( "say /vip" , "msn_vips")    
}
public msn_admin(user)  {
    new adminnames[33][32]
    new message[256]
    new id, count, x, len
    
    for(id = 1 ; id <= get_maxplayers() ; id++)
    {
        if(is_user_connected(id))
            if(get_user_flags(id) & ADMIN_BAN)
            get_user_name(id, adminnames[count++], 31)
    }
    
    len = format(message, 255, "Admins Online:^x04 ")
    
    if(count > 0) 
    {
        for(x = 0 ; x < count ; x++) 
        {
            len += format(message[len], 255-len, "%s%s.", adminnames[x], x < (count-1) ? " ,":"")
            
            if(len > 96 ) 
            {
                print_chatColor(user, message)
            }
        }
        print_chatColor(user, message)
    }
    else 
    {
        len += format(message[len], 255-len, "No Hay Admins^x04 Conectados")
        print_chatColor(user, message)
    }
    
    return PLUGIN_HANDLED
}
public msn_vips(user) 
{
    new adminnames[33][32] 
    new message[256]      
    new id, count, x, len
    
    for(id = 1 ; id <= get_maxplayers() ; id++)
    {
        if(is_user_connected(id))
            if(is_user_admin(id) && !(get_user_flags(id) & ADMIN_KICK)) // flag de vip
            get_user_name(id, adminnames[count++], 31)
    }
    
    len = format(message, 255, "VIP Online:^x04 ")  // vips dentro del servidor
    
    if(count > 0) 
    {
        for(x = 0 ; x < count ; x++) 
        {
            len += format(message[len], 255-len, "%s%s.", adminnames[x], x < (count-1) ? " ,":"")
            
            if(len > 180 ) 
            {
                print_chatColor(user, message)
            }
        }
        print_chatColor(user, message)
    }
    else 
    {
        len += format(message[len], 255-len, " No Hay VIP Conectados." ) //mensaje cuando no hay vip conectados en el servidor
        print_chatColor(user, message)
    }
    return PLUGIN_HANDLED
}
/* colores de mensajes*/
stock print_chatColor(const id,const input[], any:...)  
{
    new msg[191], players[32], count = 1;
    vformat(msg,190,input,3);
    replace_all(msg,190,"\g","^4")
    replace_all(msg,190,"\n","^1")
    replace_all(msg,190,"\t","^3")
    
    if (id) players[0] = id; else get_players(players,count,"ch");
    for (new i=0;i<count;i++)
        if (is_user_connected(players[i]))
    {
        message_begin(MSG_ONE_UNRELIABLE,get_user_msgid("SayText"),_,players[i]);
        write_byte(players[i]);
        write_string(msg);
        message_end();
    }
} 
